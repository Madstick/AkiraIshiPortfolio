<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connecting</title>
<style>
@font-face{
  font-family:"BtcOrdinal";
  src:url("https://ordinals.com/content/7fa3e94d64f96f76817357e6630425a966852d1c93bf7463adb9f45da2790f49i0") format("truetype");
  font-display: swap;
}
@font-face{
  font-family:"BtcOrdinal_e4f5";
  src:url("https://ordinals.com/content/e4f5281e46dfc811d01beecedae0b7c134664c323f3a9a1bff880d65a9321439i0") format("truetype");
  font-display: swap;
}
@font-face{
  font-family:"BtcOrdinal_316b";
  src:url("https://ordinals.com/content/316be1487c184f17d23e1272009d86d98e500a84fce53f3570b1d89afc774cf3i0") format("truetype");
  font-display: swap;
}
@font-face{
  font-family:"BtcOrdinal_c6b0";
  src:url("https://ordinals.com/content/c6b0eee61019fe341461304cbfb5e6a67d508a9fdc142e71b0c729bd967cacbci0") format("woff2");
  font-display: swap;
}
@font-face{
  font-family:"BtcOrdinal_7080";
  src:url("https://ordinals.com/content/7080272f1e7d9b0a2958be7028a0de474841abf9b7aa6850399b66afb40f8827i0") format("woff2");
  font-display: swap;
}
@font-face{
  font-family:"BtcOrdinal_4c97";
  src:url("https://ordinals.com/content/4c97967f86b38836a5bbbbce27a281135b2b659d2e709126945665fff22e48c0i0") format("woff");
  font-style: normal;
  font-weight: 700;
  font-display: swap;
}
@font-face{
  font-family:"BtcOrdinal_603c";
  src:url("https://ordinals.com/content/603ccf6f231ef2fecce48777dde37284dbb8edf7b1862fda7c3300b9abe667aei0") format("opentype");
  font-style: normal;
  font-weight: 700;
  font-display: swap;
}
html { -webkit-text-size-adjust: 100%; text-size-adjust: 100%; }
:root { --stage-w: min(100vw, 56.25vh);--orange:#F7931A; }
  html, body { height: 100%; margin: 0; background: #0b0d10; color: #e6e6e6; font-family: "BtcOrdinal"; }
  #wrap { position: fixed; inset: 0; display: grid; place-items: center; grid-template-rows: 1fr; }
  #stage { position: relative; width: min(100vw, 56.25vh); aspect-ratio: 9/16; box-shadow: 0 0 0 1px #000 inset; }
  canvas { width: 100%; height: 100%; display: block; touch-action: none; font-synthesis-weight: none; overscroll-behavior: contain; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
  #hud { position: fixed; left: 0; right: 0; bottom: 0; font-size: 12px; letter-spacing: .35px; opacity: .85; padding: 8px 12px; display: flex; gap: 12px; align-items: center; justify-content: space-between; background: linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.35)); }
  .hint { opacity: .75 }
  .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; background: var(--orange); box-shadow: 0 0 10px #F7931A66; }
  a { color: var(--orange); text-decoration: none; }
#stage { position: relative; } 
.ui-toggle{
  position: absolute;
  --sz: calc(var(--stage-w) * 0.050); 
  --bar-w: calc(var(--sz) * 0.78);
  --bar-h: calc(var(--sz) * 0.09);
  --bar-gap: calc(var(--sz) * 0.04);

  top:  calc(var(--stage-w) * 0.040);
  right: calc(var(--stage-w) * 0.040);
  width: var(--sz);
  height: var(--sz);
  z-index: 4;
  border: 0;
  background: transparent;
  cursor: pointer;
  display: grid;
  place-items: center;
  padding: 0;
  border-radius: calc(var(--sz) * 0.22);
}

.ui-toggle span,
.ui-toggle::before,
.ui-toggle::after { pointer-events: none; }

.ui-toggle span,
.ui-toggle::before,
.ui-toggle::after{
  content: "";
  display: block;
  width: var(--bar-w);
  height: var(--bar-h);
  background: #fff;
  opacity: .9;
  border-radius: calc(var(--bar-h) * 0.9);
  transition: transform .25s ease, opacity .25s ease;
}

.ui-toggle::before { transform: translateY(calc(-1 * var(--bar-gap))); }
.ui-toggle::after  { transform: translateY(var(--bar-gap)); }

#ui {
  position: absolute; inset: 0; pointer-events: none; z-index: 3;
  color: #fff;
  font-size: max(14px, calc(var(--stage-w) * 0.054));
  line-height: 1.9;
}

.ui-row {
  position: absolute; left: 6%; right: 6%;
  display: flex; justify-content: center; align-items: center;
  gap: 12px; flex-wrap: wrap;
  text-align: center;
}
.ui-stack { flex-direction: column; gap: 10px; }

.ui-title { font-weight: 700; letter-spacing: .02em; }

.ui-wrap { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; width: 100%; }

.ui-chip {
  white-space: normal;
  max-width: 100%;
  text-align: center;
  flex: 0 1 auto;
}

@media (min-width: 1024px) {
  #uiTop { top: 4%; }
  #uiBottom { bottom: 6%; }
}
#uiTop    { top: 4%;  }
#uiBottom { bottom: 8%; }
@media (max-width: 420px) {
  .ui-row { left: 3%; right: 3%; gap: 8px; }
  .ui-chip { padding: 4px 6px; }
  #uiTop    { top: 2%;  }
  #ui { font-size: max(12px, calc(var(--stage-w) * 0.054));line-height: 1.4; }
}
#stage:not(.ui-open) #ui { display: none; }

.help-icon {
  position: absolute;
  bottom: calc(var(--stage-w) * 0.040);
  left: calc(var(--stage-w) * 0.040);
  width: calc(var(--stage-w) * 0.045);
  height: calc(var(--stage-w) * 0.045);
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 5;
  font-family: "BtcOrdinal", monospace;
  font-size: calc(var(--stage-w) * 0.025);
  color: rgba(255, 255, 255, 0.8);
  transition: all 0.3s ease;
  backdrop-filter: blur(4px);
}

.help-icon:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.5);
  color: rgba(255, 255, 255, 1);
  transform: scale(1.1);
}

.help-info {
  position: absolute;
  top: 5%;
  left: 5%;
  width: 90%;
  height: 90%;
  background: rgba(0, 0, 0, 0.92);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 8px;
  padding: 1rem;
  color: rgba(255, 255, 255, 0.9);
  font-family: var(--btc-font, "BtcOrdinal"), monospace;
  font-size: 0.8rem;
  line-height: 1.3;
  z-index: 1000;
  backdrop-filter: blur(12px);
  opacity: 0;
  visibility: hidden;
  transform: scale(0.9);
  transition: all 0.3s ease;
  overflow-y: auto;
  box-sizing: border-box;
}

.help-info.show {
  opacity: 1;
  visibility: visible;
  transform: scale(1);
}

.help-content h3 {
  margin: 0 0 0.75rem 0;
  color: #F7931A;
  font-size: 1rem;
  text-align: center;
  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
  padding-bottom: 0.5rem;
}

.help-content h4 {
  margin: 1rem 0 0.5rem 0;
  color: rgba(255, 255, 255, 0.95);
  font-size: 0.85rem;
  border-left: 3px solid #F7931A;
  padding-left: 0.5rem;
}

.help-content p {
  margin: 0.5rem 0;
  color: rgba(255, 255, 255, 0.85);
}

.help-sections {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin: 1rem 0;
}

.help-section {
  flex: 1;
}

.help-section ul {
  margin: 0.5rem 0;
  padding-left: 1.2rem;
}

.help-section li {
  margin: 0.3rem 0;
  color: rgba(255, 255, 255, 0.8);
}

.help-section strong {
  color: #F7931A;
}

.help-close-hint {
  text-align: center;
  margin-top: 1rem;
  padding-top: 0.75rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.6);
  font-size: 0.7rem;
  font-style: italic;
}

.font-controls {
  position: absolute;
  top: calc(var(--stage-w) * 0.040);
  left: calc(var(--stage-w) * 0.040);
  display: flex;
  gap: 8px;
  z-index: 5;
}

#stage:not(.ui-open) .font-controls {
  display: none;
}

.font-btn {
  width: calc(var(--stage-w) * 0.045);
  height: calc(var(--stage-w) * 0.045);
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-family: "BtcOrdinal", monospace;
  font-size: calc(var(--stage-w) * 0.020);
  color: rgba(255, 255, 255, 0.8);
  transition: all 0.3s ease;
  backdrop-filter: blur(4px);
  pointer-events: auto;
}

.font-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.5);
  color: rgba(255, 255, 255, 1);
  transform: scale(1.05);
}

.font-btn.locked {
  background: rgba(247, 147, 26, 0.3);
  border-color: rgba(247, 147, 26, 0.6);
  color: #F7931A;
}

.font-btn.locked:hover {
  background: rgba(247, 147, 26, 0.4);
  border-color: rgba(247, 147, 26, 0.8);
}

@media (max-width: 420px) {
  .font-controls {
    top: calc(var(--stage-w) * 0.025);
    left: calc(var(--stage-w) * 0.025);
    gap: 6px;
  }
  
  .font-btn {
    width: calc(var(--stage-w) * 0.055);
    height: calc(var(--stage-w) * 0.055);
    font-size: calc(var(--stage-w) * 0.022);
  }
  
  .help-icon {
    width: calc(var(--stage-w) * 0.055);
    height: calc(var(--stage-w) * 0.055);
    font-size: calc(var(--stage-w) * 0.030);
  }
  
  .help-info {
    width: calc(var(--stage-w) * 0.90);
    font-size: calc(var(--stage-w) * 0.022);
    padding: calc(var(--stage-w) * 0.030);
  }
}

</style>

</head>
<body>
<div id="wrap">
  <div id="stage"><canvas id="c"></canvas>
      <button class="ui-toggle" id="uiToggle" aria-label="Toggle UI"><span></span></button>

      <div class="font-controls">
        <button class="font-btn" id="fontCycle" aria-label="Cycle Font" title="Cycle Font">F</button>
        <button class="font-btn" id="fontLock" aria-label="Lock Font" title="Lock/Unlock Font">ðŸ”“</button>
        <button class="font-btn" id="activityOverride" aria-label="Activity Override" title="Activity Override: Auto">A</button>
      </div>

      <div class="help-icon" id="helpIcon" aria-label="Help">?</div>
      <div class="help-info" id="helpInfo">
        <div class="help-content">
          <h3>Connecting</h3>
          <p>"Connecting" is a living system, breathing to the pulse of the Bitcoin blockchain. Each particle an entity, each link a connection. The collective energy of the network is drawn together by the gravitational force of the symbol itself.</p> 
           <p>It reflects individual motion converging into collective meaning</p>
          
          <div class="help-sections">
            <div class="help-section">
              <h4>Controls</h4>
              <ul>
                <li><strong>Interact:</strong> Mouse / touch to push particles</li>
                <li><strong>Lens:</strong> Right-click / Pinch (mobile) + drag to zoom</li>
                <li><strong>Zoom:</strong> Mouse wheel to adjust lens magnification / Enlarge or shrink the pinch (mobile)</li>
                <li><strong>Hide UI:</strong> Press 'H' key / Triple Tap (mobile)</li>
              </ul>
            </div>

          </div>
          
          <div class="help-section">
            <h4>Interface Elements</h4>
            <p><strong>Top Right Icon:</strong> Access blockchain data including transaction fees and block information. Also Font icons</p>
            <p><strong>Font Icons:</strong> Cycle through different Bitcoin Ordinal fonts (F) and lock the current font (ðŸ”“) to prevent changes during block updates.</p>
          </div>
          
          <div class="help-section">
            <h4>Technical Infos</h4>
            <p>This piece was specifically designed to be exposed, on a tablet or large screen, it is interactive and responsive to the blockchain activity</p> 
            <p>The custom algorithm uses blockchain data to simulate the gravitational pull of the Bitcoin symbol, speed of the particles, number of links and background colors.</p>
            <p>Activity is calculated using live fee rates, pending mempool transactions, and recent historical data to stay adaptive to fee and market shifts </p>
            <p>The artwork is refreshed and reset with every new block mined</p>
          </div>
          
          <div class="help-close-hint">
            Click/Touch anywhere to close
          </div>
        </div>
      </div>

    <div id="ui" aria-live="polite">
<div id="uiTop" class="ui-row ui-stack">
  <div class="ui-title">Fees</div>
  <div class="ui-wrap">
    <div class="ui-chip" id="feeFast">fastest: â€” sat/vB</div>
    <div class="ui-chip" id="feeHalf">~30m: â€” sat/vB</div>
    <div class="ui-chip" id="feeHour">~60m: â€” sat/vB</div>
  </div>
</div>

<div id="uiBottom" class="ui-row ui-stack">
  <div class="ui-chip" id="blockNum">Block: â€”</div>
  <div class="ui-chip" id="pending">Awaiting: â€” txs</div>
</div>
      </div>
    </div>
  </div>
</div>

<script>  
const ORDINAL_FAMILIES=["BtcOrdinal_7080","BtcOrdinal_4c97","BtcOrdinal_c6b0","BtcOrdinal_603c","BtcOrdinal","BtcOrdinal_e4f5","BtcOrdinal_316b"];function pickRandom(t){return t[Math.random()*t.length|0]}async function chooseOrdinalFont(){await Promise.allSettled(ORDINAL_FAMILIES.map((t=>document.fonts.load(`700 200px "${t}"`,"B")))),await document.fonts.ready;const t=ORDINAL_FAMILIES.filter((t=>document.fonts.check(`700 48px "${t}"`,"B")));let e=pickRandom(t.length?t:ORDINAL_FAMILIES);return document.fonts.check(`700 48px "${e}"`,"B")||(e="BtcOrdinal"),document.documentElement.style.setProperty("--app-font",`"${e}"`),document.documentElement.style.setProperty("--btc-font",`"${e}"`),document.body&&(document.body.style.fontFamily="var(--app-font)"),window.__BTC_FONT__=e,console.log("[btc-font] available:",t,"chosen:",e),e}let currentFontIndex=0,fontLocked=!1,availableFonts=[],activityOverride=0,manualActivityLevel=0;const HISTORY_SIZE=1440,ACTIVITY_HISTORY={fees:[],pending:[]},ACTIVITY_STATES=[0,.25,.35,.5,.75,1];let activityEMA=0;function pushHistory(t,e){t.push(e),t.length>HISTORY_SIZE&&t.shift()}function percentile(t,e){if(t.length<10)return 0;let n=0;for(const o of t)o<=e&&n++;return n/t.length}function percentileValue(t,e){if(0===t.length)return 0;const n=[...t].sort(((t,e)=>t-e));return n[Math.floor(e*(n.length-1))]}function normalize(t,e,n){return n<=e?0:Math.max(0,Math.min(1,(t-e)/(n-e)))}function snapActivity(t){let e=ACTIVITY_STATES[0],n=1/0;for(const o of ACTIVITY_STATES){const i=Math.abs(t-o);i<n&&(n=i,e=o)}return e}async function initializeFontCycling(){await Promise.allSettled(ORDINAL_FAMILIES.map((t=>document.fonts.load(`700 200px "${t}"`,"B")))),await document.fonts.ready,availableFonts=ORDINAL_FAMILIES.filter((t=>document.fonts.check(`700 48px "${t}"`,"B"))),0===availableFonts.length&&(availableFonts=ORDINAL_FAMILIES);const t=window.__BTC_FONT__||"BtcOrdinal";currentFontIndex=availableFonts.indexOf(t),-1===currentFontIndex&&(currentFontIndex=0)}function cycleFont(){if(fontLocked)return;currentFontIndex=(currentFontIndex+1)%availableFonts.length;const t=availableFonts[currentFontIndex];document.documentElement.style.setProperty("--app-font",`"${t}"`),document.documentElement.style.setProperty("--btc-font",`"${t}"`),document.body&&(document.body.style.fontFamily="var(--app-font)"),window.__BTC_FONT__=t,window.regenerateBitcoinMask&&window.regenerateBitcoinMask(),console.log("[font-cycle] switched to:",t)}function toggleFontLock(){fontLocked=!fontLocked;const t=document.getElementById("fontLock");fontLocked?(t.textContent="ðŸ”’",t.classList.add("locked"),t.title="Unlock Font"):(t.textContent="ðŸ”“",t.classList.remove("locked"),t.title="Lock Font"),console.log("[font-lock] font is now:",fontLocked?"locked":"unlocked")}function toggleActivityOverride(){console.log("[activity-override] Function not yet initialized - startApp() must run first")}function startApp(){let t=0,e=0;const n=(t,e,n)=>Math.max(e,Math.min(n,t)),o=900,i=1600,c=9e3,a=/Android/i.test(navigator.userAgent);window.PIXEL_BUDGET=a?2e6:6e6;const l=[0,.25,.35,.5,.75,1],r=[0,.03,.05,.07,.05,.07],s=2;let f=-1;const d=.1,h=.02,u=120,m=u*u,y=.52;let g;const p=3600;let v=0,x=null,w=null,I=new Uint8Array(o*i),b=[],B=0,M=0,_=[];const A=1;let O=0;Array.from({length:8},(()=>[]));let k=0;function T(t,e){const n=0|t,c=0|e;return n<0||c<0||n>=o||c>=i?0:0|I[c*o+n]}let E={root:null,toggleBtn:null,feeFast:null,feeHalf:null,feeHour:null,blockNum:null,pending:null},F={fastestFee:null,halfHourFee:null,hourFee:null},L=null;const C=.025*o,S={active:!1,id:-1,x:0,y:0,px:0,py:0,vx:0,vy:0},R={active:!1,x:.5*o,y:.5*i,r:.2*Math.min(o,i),zoom:1.8,feather:24},N=1.5,$=4,D=1,P=.25,H=.45*Math.min(o,i),z=new Map,Y={active:!1,startDist:0,baseZoom:0};function U(){let t=0,e=0;for(const n of z.values())t+=n.x,e+=n.y;const n=z.size||1;return{x:t/n,y:e/n}}function V(){const t=z.values(),e=t.next().value,n=t.next().value;if(!e||!n)return 0;const o=e.x-n.x,i=e.y-n.y;return Math.hypot(o,i)}const K=520,q=14,G=160,X=1.4,Z="rgba(255,200,120,",j=[];function W(t,e){for(let n=0;n<3;n++)j.length>=24&&j.shift(),j.push({x:t,y:e,t0:performance.now(),delay:70*n})}const Q=2*Math.PI,J=(t,e,n)=>t+(e-t)*n;function tt(t){return function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}class et{constructor(t,e,n){this.cell=n,this.cols=Math.ceil(t/n),this.rows=Math.ceil(e/n),this.LINK_BINS=new Array(this.cols*this.rows);for(let t=0;t<this.LINK_BINS.length;t++)this.LINK_BINS[t]=[]}clear(){for(let t=0;t<this.LINK_BINS.length;t++)this.LINK_BINS[t].length=0}key(t,e){const n=Math.floor(t/this.cell),o=Math.floor(e/this.cell);return o<0||n<0||n>=this.cols||o>=this.rows?-1:o*this.cols+n}insert(t){const e=this.key(t.x,t.y);e>=0&&this.LINK_BINS[e].push(t)}neighbors(t,e,n,o){const i=Math.ceil(n/this.cell),c=Math.floor(t/this.cell),a=Math.floor(e/this.cell);for(let t=-i;t<=i;t++)for(let e=-i;e<=i;e++){const n=(a+t)*this.cols+(c+e);if(n>=0&&n<this.LINK_BINS.length){const t=this.LINK_BINS[n];for(let e=0;e<t.length;e++)o.push(t[e])}}return o}}const nt=document.getElementById("c"),ot=nt.getContext("2d",{alpha:!1});window.PIXEL_BUDGET=window.PIXEL_BUDGET||6e6;let it=1,ct=Math.floor(.66*window.PIXEL_BUDGET),at=1,lt=null,rt=null;function st(){const t=nt.getBoundingClientRect(),e=t.width,n=t.height,c=window.devicePixelRatio||1,l=Math.min(e*c/o,n*c/i),r=Math.max(1,Math.floor(l)),s=Math.max(1,Math.floor(Math.sqrt(PIXEL_BUDGET/(o*i)))),f=Math.min(r,s);it=f;const d=o*f,h=i*f;nt.width===d&&nt.height===h||(nt.width=d,nt.height=h),ot.setTransform(f,0,0,f,0,0),ot.imageSmoothingEnabled=!1,function(){const t=Math.min(window.devicePixelRatio||1,2),e=Math.sqrt(ct/(o*i)),n=Math.max(1,Math.min(it,t));at=Math.max(1,Math.min(t,e,n)),a&&(at=Math.min(at,1.2));const c=0|Math.floor(o*at),l=0|Math.floor(i*at);lt=new OffscreenCanvas(c,l),rt=lt.getContext("2d",{alpha:!1}),rt.setTransform(at,0,0,at,0,0)}()}const ft=document.createElement("canvas");ft.width=o,ft.height=i;const dt=ft.getContext("2d"),ht=document.createElement("canvas");let ut=ht.getContext("2d");const mt=12;new et(o,i,mt);const yt={x:0,y:0},gt=.12,pt=.006;let vt=0,xt=0;const wt=document.createElement("canvas");let It,bt,Bt,Mt,_t,At,Ot,kt,Tt,Et,Ft=wt.getContext("2d"),Lt=o,Ct=i,St=tt(Date.now()>>>0^11631617),Rt=[],Nt=0,$t=0;const Dt="#c9810c",Pt=[[Dt,"#f2882c"]],Ht=[{text:"Alone,",x:.01*o,y:.02*i},{text:"we",x:.77*o,y:.08*i},{text:"cannot",x:.02*o,y:.15*i},{text:"do",x:.89*o,y:.22*i},{text:"anything.",x:.005*o,y:.35*i},{text:"Together",x:.45*o,y:.48*i},{text:"can",x:.01*o,y:.82*i},{text:"everything",x:.75*o,y:.96*i},{text:"awcda. twcde",x:.52*o,y:.98*i}];function zt(t,e=0,n=!1,i=1){if(t.save(),n){const e=.2,n=e+(1-e)*Math.min(1,(i-1)/3),c=Math.max(6,.02*o)*n;t.font=`300 ${c}px "${window.__BTC_FONT__||"BtcOrdinal"}", monospace`,t.fillStyle="#F7931A",t.globalAlpha=.05}else{const e=Math.max(6,.02*o);t.font=`300 ${e}px "${window.__BTC_FONT__||"BtcOrdinal"}", monospace`,t.fillStyle="#0b0d10",t.globalAlpha=0}t.textAlign="left",t.textBaseline="top";for(const e of Ht)t.fillText(e.text,e.x,e.y);t.restore()}let Yt=null,Ut=null;const Vt=document.createElement("canvas");Vt.width=o,Vt.height=i;const Kt=Vt.getContext("2d",{alpha:!0});Kt.globalAlpha=.06,Kt.fillStyle="#000";for(let t=2;t<i;t+=3)Kt.fillRect(0,t,o,1);Kt.globalAlpha=.05;for(let t=0;t<400;t++){const t=St()*o|0,e=St()*i|0;Kt.fillRect(t,e,1,1)}Kt.globalAlpha=1;const qt=.18,Gt=1,Xt=.35,Zt=1,jt=.5,Wt=.98,Qt=.7,Jt=1,te=.42,ee=.9186;let ne=ee,oe=ne,ie=-1,ce=null;function ae(t){if(activityOverride>0){const t=manualActivityLevel,e=t;return oe=J(oe,te+(ee-te)*e,.08),ne=oe,vt=t,void(xt=e)}const e=n(t,0,1);if(e===ie)return;ie=e;const o=e,i=te+(ee-te)*o;oe=J(oe,i,.08),ne=oe,vt=e,xt=o,console.log("[damp] activityâ†’damp",{activity:e,eased:o,target:i,baseDampLive:ne,DAMP_MIN:te,DAMP_MAX:ee}),ke(xt)}window.toggleActivityOverride=function(){activityOverride=(activityOverride+1)%6;const t=document.getElementById("activityOverride");if(0===activityOverride)t.textContent="A",t.title="Activity Override: Auto",t.classList.remove("locked"),console.log("[activity-override] Auto mode - fetching current chain data"),f=-1,xt=g,ae(xt),Le().catch((t=>{console.log("[activity-override] Failed to fetch activity on auto switch:",t.message)})),He(15e3);else{t.textContent=activityOverride.toString(),t.title=`Activity Override: Level ${activityOverride}`,t.classList.add("locked"),manualActivityLevel=l[activityOverride],g=manualActivityLevel;oe=J(oe,te+(ee-te)*g,.08),ne=oe,vt=manualActivityLevel,xt=g,console.log(`[activity-override] Manual level ${activityOverride} (${manualActivityLevel}) applied immediately`),ke(xt)}};const le=new OffscreenCanvas(o,i),re=le.getContext("2d",{alpha:!0}),se=1e3;let fe=0,de=null,he=null,ue=!1;le.width=o,le.height=i;const me=new OffscreenCanvas(o,i),ye=me.getContext("2d",{alpha:!0});me.width=o,me.height=i,ye.imageSmoothingEnabled=!1;navigator.hardwareConcurrency;const ge=new Map;function pe(t,e){const n=Math.max(1,Math.round(e)),o=t+":"+n;let i=ge.get(o);return i||(i=function(t,e){const n=document.createElement("canvas"),o=Math.max(2,2*t|0)+2;n.width=n.height=o;const i=n.getContext("2d",{alpha:!0});return i.fillStyle=e,i.beginPath(),i.arc(o/2,o/2,t,0,Q),i.fill(),n}(n,t),ge.set(o,i)),i}function ve(t){St=tt(t>>>0),It=function(t=1){const e=tt(t),n=new Float32Array(256);for(let t=0;t<256;t++)n[t]=1e3*e();const o=new Uint8Array(512);for(let t=0;t<256;t++)o[t]=t;for(let t=0;t<256;t++){const n=256*e()|0;[o[t],o[n]]=[o[n],o[t]]}for(let t=0;t<256;t++)o[256+t]=o[t];const i=t=>t*t*t*(t*(6*t-15)+10),c=(t,e,n)=>t+(e-t)*n,a=(t,e)=>n[o[t+o[e]]];function l(t,e){const n=255&Math.floor(t),o=255&Math.floor(e),l=t-Math.floor(t),r=e-Math.floor(e),s=i(l),f=i(r),d=a(n,o),h=a(n+1,o),u=a(n,o+1),m=a(n+1,o+1),y=c(d,h,s),g=c(u,m,s);return c(y,g,f)}return{value:l,curl:function(t,e,n=1){const o=.001,i=l((t+o)*n,e*n),c=l((t-o)*n,e*n);return{x:-(l(t*n,(e+o)*n)-l(t*n,(e-o)*n))/(2*o),y:(i-c)/(2*o)}},curlOut:function(t,e,n=1,o){const i=.001,c=(l((t+i)*n,e*n)-l((t-i)*n,e*n))/(2*i),a=(l(t*n,(e+i)*n)-l(t*n,(e-i)*n))/(2*i);return o.x=-a,o.y=c,o}}}(t>>>0)}function xe(){st()}!function(){dt.fillStyle="#000",dt.fillRect(0,0,o,i);const t=.9*Math.min(o,i),e=1.5*(t-2*(.06*t));dt.fillStyle="#fff",dt.textAlign="center",dt.textBaseline="alphabetic",dt.save(),dt.translate(o/2+C,i/2);const n=window.__BTC_FONT__||"BtcOrdinal";dt.font=`700 ${e}px "${n}"`;const c=new Set(["BtcOrdinal_4c97","BtcOrdinal_603c","BtcOrdinal_c6b0"]),a=!c.has(n)&&document.fonts.check(`700 ${e}px "${n}"`,"â‚¿"),l=c.has(n)||!a?"B":"â‚¿";console.log("[btc-font] canvas font:",dt.font);const r=dt.measureText(l),s=r.width,f=.63*e;let d=f/Math.max(1,s);d=Math.max(.85,Math.min(1.25,d));dt.scale(d,1.06);const h=r.actualBoundingBoxAscent,u=r.actualBoundingBoxDescent,m=(h-u)/2;dt.fillText(l,0,m);const y=e*("BtcOrdinal_316b"===n?.065:.075),g=e*({BtcOrdinal_7080:.28,BtcOrdinal_4c97:.28,BtcOrdinal_603c:.32,BtcOrdinal:.002,BtcOrdinal_c6b0:.002,BtcOrdinal_e4f5:.28,BtcOrdinal_316b:.28}[window.__BTC_FONT__||"BtcOrdinal"]??.28),p=.02*-e,v=m-.83*h,x=new Set(["BtcOrdinal_4c97","BtcOrdinal_603c","BtcOrdinal_c6b0","BtcOrdinal_7080"]),w=v*({BtcOrdinal_7080:1,BtcOrdinal_316b:.97}[n]??(x.has(n)?1.35:.95)),I=m+.18*u-.066*h;if(dt.fillRect(p-g,w-y/2,g,y),dt.fillRect(p-g,I-y/2,g,y),!a){const t=.9*y,o=.1*e,i=.18*-f,c=.05*f,a=new Set(["BtcOrdinal_4c97","BtcOrdinal_603c","BtcOrdinal_c6b0"]).has(n)?.015*f:0;dt.fillRect(i+a-t/2,w-o,t,o),dt.fillRect(c+a-t/2,w-o,t,o),dt.fillRect(i-t/2,I,t,o),dt.fillRect(c-t/2,I,t,o)}dt.restore()}();const we=dt.getImageData(0,0,o,i).data;let Ie=null,be=null;function Be(){Ie=new Float32Array(o*i),be=new Float32Array(o*i);for(let t=0;t<i;t++)for(let e=0;e<o;e++){const n=Me(e+1,t)-Me(e-1,t),i=Me(e,t+1)-Me(e,t-1),c=Math.hypot(n,i)||1,a=t*o+e;Ie[a]=n/c,be[a]=i/c}}function Me(t,e){const n=0|t,c=0|e;if(n<0||c<0||n>=o||c>=i)return 0;return we[4*(c*o+n)]/255}!function(){wt.width=o,wt.height=i;const t=o,e=i,n=.5*t+C,c=.5*e,a=.1*Math.min(t,e),l=.46*Math.min(t,e),r=Ft.createRadialGradient(n,c,a,n,c,l);r.addColorStop(0,"rgba(225,120,0,0.98)"),r.addColorStop(.6,"rgba(225,120,0,0.30)"),r.addColorStop(1,"rgba(225,120,0,0.00)"),Ft.clearRect(0,0,t,e),Ft.fillStyle=r,Ft.fillRect(0,0,t,e),ht.width=o,ht.height=i,ut.globalCompositeOperation="source-over",ut.clearRect(0,0,o,i),ut.drawImage(wt,0,0),ut.globalCompositeOperation="destination-in",ut.drawImage(ft,0,0)}();const _e=new Uint8Array(o*i);function Ae(t,e){const n=0|t,c=0|e;return!(n<0||c<0||n>=o||c>=i)&&1===_e[c*o+n]}!function(){const t=new Uint8Array(o*i),e=new Int32Array(o*i),n=new Int32Array(o*i);let c=0,a=0;function l(i,c){const l=c*o+i;t[l]||(t[l]=1,e[a]=i,n[a]=c,a++)}for(let t=0;t<o;t++)0===Me(t,0)&&l(t,0),0===Me(t,i-1)&&l(t,i-1);for(let t=0;t<i;t++)0===Me(0,t)&&l(0,t),0===Me(o-1,t)&&l(o-1,t);for(;c<a;){const l=e[c],r=n[c];c++;const s=[[1,0],[-1,0],[0,1],[0,-1]];for(let c=0;c<4;c++){const f=l+s[c][0],d=r+s[c][1];if(f<0||d<0||f>=o||d>=i)continue;const h=d*o+f;t[h]||0===Me(f,d)&&(t[h]=1,e[a]=f,n[a]=d,a++)}}for(let e=0;e<i;e++)for(let n=0;n<o;n++){const i=e*o+n;_e[i]=0!==Me(n,e)||t[i]?0:1}}(),function(){I.fill(0),b.length=0;const t=new Uint8Array(o*i),e=new Int32Array(o*i),n=new Int32Array(o*i);let c=0,a=0,l=1;for(let r=0;r<i;r++)for(let s=0;s<o;s++){const f=r*o+s;if(!_e[f]||t[f])continue;let d=0,h=0,u=0;for(c=a=0,e[c]=s,n[c]=r,c++,t[f]=1;a<c;){const r=e[a],s=n[a];a++;const f=s*o+r;if(I[f]=l,d++,h+=r,u+=s,r>0){const o=f-1;_e[o]&&!t[o]&&(t[o]=1,e[c]=r-1,n[c]=s,c++)}if(r<o-1){const o=f+1;_e[o]&&!t[o]&&(t[o]=1,e[c]=r+1,n[c]=s,c++)}if(s>0){const i=f-o;_e[i]&&!t[i]&&(t[i]=1,e[c]=r,n[c]=s-1,c++)}if(s<i-1){const i=f+o;_e[i]&&!t[i]&&(t[i]=1,e[c]=r,n[c]=s+1,c++)}}b.push({id:l,cx:h/d,cy:u/d,area:d}),l++}b.length>=2&&(b.sort(((t,e)=>t.cy-e.cy)),B=b[0].id,M=b[1].id),_=[];for(const t of b)_[t.id]=t}(),Be(),window.regenerateBitcoinMask=function(){dt.setTransform(1,0,0,1,0,0),dt.fillStyle="#000",dt.fillRect(0,0,o,i);const t=.9*Math.min(o,i),e=1.5*(t-2*(.06*t));dt.fillStyle="#fff",dt.textAlign="center",dt.textBaseline="alphabetic",dt.save(),dt.translate(o/2+C,i/2);const n=window.__BTC_FONT__||"BtcOrdinal";dt.font=`700 ${e}px "${n}"`;const c=new Set(["BtcOrdinal_4c97","BtcOrdinal_603c","BtcOrdinal_c6b0"]),a=!c.has(n)&&document.fonts.check(`700 ${e}px "${n}"`,"â‚¿"),l=c.has(n)||!a?"B":"â‚¿",r=dt.measureText(l),s=r.width,f=.63*e;let d=f/Math.max(1,s);d=Math.max(.85,Math.min(1.25,d));dt.scale(d,1.06);const h=r.actualBoundingBoxAscent,u=r.actualBoundingBoxDescent,m=(h-u)/2;dt.fillText(l,0,m);const y=e*("BtcOrdinal_316b"===n?.065:.075),g=e*({BtcOrdinal_7080:.28,BtcOrdinal_4c97:.28,BtcOrdinal_603c:.32,BtcOrdinal:.002,BtcOrdinal_c6b0:.002,BtcOrdinal_e4f5:.28,BtcOrdinal_316b:.28}[window.__BTC_FONT__||"BtcOrdinal"]??.28),p=.02*-e,v=m-.83*h,x=new Set(["BtcOrdinal_4c97","BtcOrdinal_603c","BtcOrdinal_c6b0","BtcOrdinal_7080"]),w=v*({BtcOrdinal_7080:1,BtcOrdinal_316b:.97}[n]??(x.has(n)?1.35:.95)),I=m+.18*u-.066*h;if(dt.fillRect(p-g,w-y/2,g,y),dt.fillRect(p-g,I-y/2,g,y),!a){const t=.9*y,o=.1*e,i=.18*-f,c=.05*f,a=new Set(["BtcOrdinal_4c97","BtcOrdinal_603c","BtcOrdinal_c6b0"]).has(n)?.015*f:0;dt.fillRect(i+a-t/2,w-o,t,o),dt.fillRect(c+a-t/2,w-o,t,o),dt.fillRect(i-t/2,I,t,o),dt.fillRect(c-t/2,I,t,o)}dt.restore();const b=dt.getImageData(0,0,o,i);for(let t=0;t<we.length;t++)we[t]=b.data[t];_e.fill(0);const B=new Uint8Array(o*i),M=new Int32Array(o*i),_=new Int32Array(o*i);let A=0,O=0;const k=(t,e)=>{M[O]=t,_[O]=e,O++};for(let t=0;t<o;t++)0===we[4*(0*o+t)]&&k(t,0),0===we[4*((i-1)*o+t)]&&k(t,i-1);for(let t=0;t<i;t++)0===we[4*(t*o+0)]&&k(0,t),0===we[4*(t*o+(o-1))]&&k(o-1,t);for(;A<O;){const t=M[A],e=_[A];A++;const n=e*o+t;if(B[n])continue;B[n]=1;const c=[[-1,0],[1,0],[0,-1],[0,1]];for(const[n,a]of c){const c=t+n,l=e+a;if(c>=0&&c<o&&l>=0&&l<i){const t=l*o+c;B[t]||0!==we[4*t]||k(c,l)}}}for(let t=0;t<o*i;t++)0!==we[4*t]||B[t]||(_e[t]=1);Be(),console.log("[mask-regen] Bitcoin symbol mask regenerated with font:",n)};Date.now();function Oe(t){ve(null!=t?t>>>0:Date.now()+1337*++e>>>0^11631617),function(){Rt=[],t=c,$t=t,bt=new Float32Array(t),Bt=new Float32Array(t),Mt=new Float32Array(t),_t=new Float32Array(t),At=new Float32Array(t),Ot=new Float32Array(t),kt=new Float32Array(t),Tt=new Float32Array(t),Et=new Uint8Array(t);var t;const e=.002*Math.sqrt(o*i),n=.22*e,a=1.25*e,l=.92;let r=0;const s=Math.floor(c*(1-l)),f=new et(o,i,n);let d=0,h=60*c;for(;Rt.length<c&&d++<h;){const t=St()*o,e=St()*i,c=Me(t,e),l=c>.05;if(!l&&r>=s)continue;const d=l?.995:.02;if(St()>d)continue;const h=J(a,n,c),u=f.neighbors(t,e,h,[]);let m=!0;for(let n=0;n<u.length;n++){const o=u[n].x-t,i=u[n].y-e;if(o*o+i*i<h*h){m=!1;break}}if(!m)continue;const y=Rt.length,g={x:t,y:e,a0:c,a:c,w:J(.6,1.6,St()),flicker:St(),vx:0,vy:0,outTicks:l?0:1,i:y};Rt.push(g),f.insert(g),bt[y]=g.x,Bt[y]=g.y,Mt[y]=g.vx,_t[y]=g.vy,At[y]=g.a,Ot[y]=g.a0,kt[y]=g.w,Tt[y]=g.flicker,Et[y]=g.outTicks,l?0:r++}}(),ke(xt)}function ke(t){let e=-1;for(let n=0;n<l.length;n++)t>=l[n]&&(e=n);if(e!==f){f=e;const t=e>=0?r[e]:0;de=t,t<=0&&(Te(t),he=null,ue=!1,de=null,fe=performance.now())}}function Te(t){const e=Rt.length;if(x&&x.length===e?x.fill(0):(x=new Uint8Array(e),w=new Uint16Array(e*s)),!t||t<=0)return void(v=0);const n=Math.floor(e*t);let c=1;t>=.65&&(c=2);const a=new et(o,i,28);for(const t of Rt)a.insert(t);const l=[];for(let t=0;t<e;t++)Rt[t].a>.05&&l.push(t);l.sort(((t,e)=>At[e]-At[t]));for(let t=0;t<n&&t<l.length;t++){const e=l[t];if(x[e]>=c)continue;const n=Rt[e],o=a.neighbors(n.x,n.y,28,[]);o.sort(((t,e)=>{const o=t.x-n.x,i=t.y-n.y,c=e.x-n.x,a=e.y-n.y;return o*o+i*i-(c*c+a*a)}));for(let t=0;t<o.length&&x[e]<c;t++){const i=o[t];if(i===n||i.a<=.05)continue;const c=i.i;if(void 0===c)continue;let a=!1;for(let t=0;t<x[e];t++)if(w[e*s+t]===c){a=!0;break}if(a)continue;const l=e*s+x[e];w[l]=c,x[e]++}}v=n*c}function Ee(){var t;if(re.setTransform(1,0,0,1,0,0),re.clearRect(0,0,o,i),t=performance.now(),null!=de&&t-fe>=se&&(Te(de),de=null,fe=t,ue=!0),f<0)return;const e=r[f]||0;if(e<=0)return;re.lineWidth=1.2,re.lineCap="round";const n=.55;let c=.15+e/.6*.4;c>n&&(c=n),re.strokeStyle=Dt,re.globalAlpha=c,function(){const t=Rt.length,e=Math.max(1,Math.floor(t/3)),n=k,o=Math.min(t,n+e);let i=!1;for(let e=n;e<o;e++){const n=x?x[e]:0;if(!n)continue;const o=bt[e],c=Bt[e];let a=0;for(let i=0;i<n;i++){const n=w[e*s+i];if(n<0||n>=t)continue;const l=bt[n]-o,r=Bt[n]-c;l*l+r*r>p||(w[e*s+a]=n,a++)}a!==n&&(x[e]=a,i=!0)}k=o>=t?0:o,i&&(ue=!0)}(),ue&&(he=function(){const t=new Path2D,e=Rt.length;for(let n=0;n<e;n++){const c=x?x[n]:0;if(!c)continue;const a=bt[n],l=Bt[n];for(let r=0;r<c;r++){const c=w[n*s+r];if(c<0||c>=e)continue;const f=bt[c],d=Bt[c];if(a<0&&f<0||a>o&&f>o||l<0&&d<0||l>i&&d>i)continue;const h=f-a,u=d-l;h*h+u*u>p||(t.moveTo(a,l),t.lineTo(f,d))}}return t}(),ue=!1),he&&(re.beginPath(),re.stroke(he)),re.globalAlpha=1;let a=0;if(x)for(let t=0;t<x.length;t++)a+=x[t];v>0&&a<v&&(!function(t){const e=Rt.length;if(!t||t<=0)return;let n=1;t>=.65&&(n=2);let c=0;for(let t=0;t<e;t++)c+=x?x[t]:0;const a=v-c;if(a<=0)return;const l=Math.max(1,Math.floor(.1*a)),r=new et(o,i,28);for(const t of Rt)r.insert(t);const f=[];for(let t=0;t<e;t++)Rt[t].a>.05&&f.push(t);f.sort(((t,e)=>At[e]-At[t]));let d=0;for(let t=0;t<f.length&&d<l;t++){const e=f[t];if(x[e]>=n)continue;const o=Rt[e],i=r.neighbors(o.x,o.y,28,[]);i.sort(((t,e)=>{const n=t.x-o.x,i=t.y-o.y,c=e.x-o.x,a=e.y-o.y;return n*n+i*i-(c*c+a*a)}));for(let t=0;t<i.length&&d<l&&x[e]<n;t++){const n=i[t];if(n===o||n.a<=.05)continue;const c=n.i;if(void 0===c)continue;let a=!1;for(let t=0;t<x[e];t++)if(w[e*s+t]===c){a=!0;break}if(a)continue;const l=e*s+x[e];w[l]=c,x[e]++,d++}}}(e),ue=!0)}Oe();const Fe=[0,.25,.35,.5,.75,1];async function Le(){let t,e=!1,n=!1;try{const[o,i]=await Promise.all([fetch("https://mempool.space/api/v1/fees/recommended",{cache:"no-store"}),fetch("https://mempool.space/api/mempool",{cache:"no-store"})]);if(o.ok){const n=await o.json();F.fastestFee=n.fastestFee??null,F.halfHourFee=n.halfHourFee??null,F.hourFee=n.hourFee??null,t=F.fastestFee??F.halfHourFee??F.hourFee??0,e=!0}if(i.ok){const t=await i.json();L=t?.count??null,n=!0}}catch(t){console.log("[mempool-fees] Primary fee/mempool fetch failed:",t.message)}e&&n&&function(t,e){if(pushHistory(ACTIVITY_HISTORY.fees,t),pushHistory(ACTIVITY_HISTORY.pending,e),ACTIVITY_HISTORY.fees.length<20){const e=Math.min(5,Math.max(0,Math.floor(t)));return void ae(Fe[e])}const n=[.05,.2,.35,.55,.75,.9].map((t=>percentileValue(ACTIVITY_HISTORY.fees,t)));let o=ACTIVITY_STATES[0];for(let e=0;e<n.length;e++)t>=n[e]&&(o=ACTIVITY_STATES[e]);activityEMA=J(activityEMA,o,.15);const i=snapActivity(activityEMA);ae(i),console.log("[activity-bucketed]",{fastestFee:t,thresholds:n,level:o,activityEMA:activityEMA,snapped:i})}(t,L??0);let o=!1;try{const t=await fetch("/blockheight",{cache:"no-store",headers:{Accept:"application/json"}});if(t.ok){const e=await t.text(),n=parseInt(e,10);Number.isFinite(n)&&(null!=Yt&&n!==Yt?(Ut=Yt,Yt=n,console.log(`[block-change] New block detected! Height: ${Ut} â†’ ${Yt}`),Oe(Yt)):Yt=n,o=!0)}}catch(t){console.log("[ordinals-height] Primary block height fetch failed:",t.message)}if(!o)try{const t=await fetch("https://mempool.space/api/blocks/tip/height",{cache:"no-store"});if(t.ok){const e=Number.parseInt(await t.text(),10);Number.isFinite(e)&&(null!=Yt&&e!==Yt?(Ut=Yt,Yt=e,console.log(`[block-change] New block detected! Height: ${Ut} â†’ ${Yt}`),Oe(Yt)):Yt=e,o=!0,console.log("[mempool-backup] Using mempool block height"))}}catch(t){console.log("[mempool-backup] Backup block height fetch failed:",t.message)}e||n||(console.log("[activity] FORCED ordinal fallback"),await async function(){try{const t="ordinals.com"===location.hostname?"":"https://ordinals.com",[e,n]=await Promise.all([fetch(`${t}/blockheight`,{cache:"no-store"}),fetch(`${t}/blocktime`,{cache:"no-store"})]);if(!e.ok||!n.ok)throw new Error("ordinals endpoints failed");const o=Number((await e.text()).trim()),i=1e3*Number((await n.text()).trim()),c=(Date.now()-i)/1e3;let a;a=null!==ce&&o!==ce?1:c<120?.75:c<300?.5:c<480?.35:c<720?.25:0,ce=o,ae(a),console.log("[ordinal-fallback]",{height:o,secondsSinceBlock:Math.round(c),activity:a})}catch(t){console.warn("[ordinal-fallback] failed:",t.message)}}()),Ce()}function Ce(){if(!E.root)return;const t=t=>null==t?"â€”":t;E.feeFast.textContent=`Fastest: ${t(F.fastestFee)} sat/vB`,E.feeHalf.textContent=`~30m: ${t(F.halfHourFee)} sat/vB`,E.feeHour.textContent=`~60m: ${t(F.hourFee)} sat/vB`,E.blockNum.textContent=`Block: ${t(Yt)}`,E.pending.textContent=`Awaiting: ${t(L)} txs`}function Se(t,e,n){const o=Re(t),i=Re(e);return`rgb(${o.r+(i.r-o.r)*n|0},${o.g+(i.g-o.g)*n|0},${o.b+(i.b-o.b)*n|0})`}function Re(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:255,g:255,b:255}}function Ne(t){const e=nt.getBoundingClientRect(),n=o/e.width,c=i/e.height;return{x:(t.clientX-e.left)*n,y:(t.clientY-e.top)*c}}window.addEventListener("resize",xe),nt.addEventListener("contextmenu",(t=>(t.preventDefault(),t.stopPropagation(),!1)),{capture:!0});function $e(e){const n=tt((1664525*t^1013904223)>>>0);let c=0,a=0;for(let t=0;t<$t;t++){if(0===At[t]){const e=T(bt[t],Bt[t]);e===B?c++:e===M&&a++}}const l=.5*(c+a);let r=0;l>0&&(r=(a-c)/(2*l));const s=9e-4*Math.max(Lt,Ct),f=.45*Lt+C,g=.4*Ct;for(let e=O;e<$t;e+=A){let c=bt[e],a=Bt[e],l=Mt[e],p=_t[e],v=At[e],x=0,w=0,I=0,b=0;if(S.active&&(x=c-S.x,w=a-S.y,I=x*x+w*w,I<m&&(b=1-Math.sqrt(I)/u)),b>0){const t=y*b;l+=x*t,p+=w*t}const A=v>.02,O=(.004+.01*v)*(A?Xt+(Zt-Xt)*xt:Qt+(Jt-Qt)*xt);It.curlOut(c/s+7e-4*t,a/s-5e-4*t,1.2,yt),l+=yt.x*O,p+=yt.y*O;const k=v>.02?.5-Math.abs(.5-v):-.05;l+=.015*(n()-.5)+k*(n()-.5)*.03,p+=.015*(n()-.5)+k*(n()-.5)*.03;const E=0|c,F=0|a;let L=0,C=0;if(E>=0&&F>=0&&E<o&&F<i){const t=F*o+E;L=Ie[t],C=be[t]}const R=v>.02?0:.4,N=1-.85*b;if(l+=L*R*N,p+=C*R*N,v<=.02){const t=.08+.14*xt,e=1-.75*b;let n=0,o=0,i=0;const r=50,s=6;for(let t=0;t<s;t++){const e=t/s*Math.PI*2,l=c+Math.cos(e)*r,f=a+Math.sin(e)*r,d=Me(l,f);if(d>.02){const t=l-c,e=f-a,r=Math.hypot(t,e)||1,s=2*d;n+=t/r*s,o+=e/r*s,i++}}if(i>0){const i=Math.hypot(n,o)||1;l+=n/i*t*e,p+=o/i*t*e}else{const n=f-c,o=g-a,i=1/(Math.hypot(n,o)||1);l+=n*i*t*e*.8,p+=o*i*t*e*.8}}0;const $=0===v&&Ae(c,a);if($){const t=.45;l+=L*t,p+=C*t;const e=T(c,a);if(e>0){const t=_[e];if(t){const e=c-t.cx,n=a-t.cy,o=Math.hypot(e,n)||1,i=.15;l+=e/o*i,p+=n/o*i}}let n=0;e===M?n=1:e===B&&(n=-1);const o=gt*r*n*20;l+=L*o,p+=C*o}else v>.02&&(p+=-Math.sign(r)*pt*(1-.9*b));const D=0===v&&Me(c+10*L,a+10*C)>0;if(v>0&&v<d||D){D&&(l+=.35*L,p+=.35*C);const t=l*L+p*C;t<0&&(l-=.15*t*L,p-=.15*t*C);const e=L;l+=-C*h*(n()-.5),p+=e*h*(n()-.5)}const P=ne,H=.22+-.12*xt;let z=Math.max(.35,Math.min(.92,P-H));const Y=J(Math.max(.14,P-.15),P,xt);let U,V;U=$?Y:v>.02?P:z,l*=U,p*=U,V=$?J(jt,Gt,xt):A?qt+(Gt-qt)*xt:jt+(Wt-jt)*xt,c+=.11*l*V,a+=.11*p*V,c<0?c+=Lt:c>=Lt&&(c-=Lt),a<0?a+=Ct:a>=Ct&&(a-=Ct),v=Me(c,a),At[e]=v,Tt[e]+=.005+.01*n(),bt[e]=c,Bt[e]=a,Mt[e]=l,_t[e]=p}O=(O+1)%A,function(){for(let t=0;t<$t;t++){const e=Rt[t];e.x=bt[t],e.y=Bt[t],e.vx=Mt[t],e.vy=_t[t],e.a=At[t],e.a0=Ot[t],e.w=kt[t],e.flicker=Tt[t],e.outTicks=Et[t]}}()}function De(){const t=rt;t.setTransform(at,0,0,at,0,0),t.globalCompositeOperation="source-over",t.globalAlpha=1,t.fillStyle="#0b0d10",t.fillRect(0,0,o,i);const e=.52+3.5*xt,n=.02+.1*xt;t.save(),t.translate(.5*Lt,.5*Ct),t.scale(e,e),t.translate(.525*-Lt,.515*-Ct),t.globalAlpha=n,t.drawImage(ht,0,0),t.restore(),t.globalAlpha=1,t.globalAlpha=1,t.globalCompositeOperation="source-over",t.drawImage(Vt,0,0),Ee(),t.drawImage(le,0,0),t.globalAlpha=1,ye.setTransform(1,0,0,1,0,0),ye.globalCompositeOperation="source-over",ye.globalAlpha=1,ye.clearRect(0,0,o,i);const c=Pt[Nt],a=Array.from({length:6},((t,e)=>Se(c[0],c[1],e/5)));for(let t=0;t<$t;t++){const e=bt[t],n=Bt[t];if(e<0||e>o||n<0||n>i)continue;const c=At[t],l=c>.02,r=l?Math.min(5,5*Math.pow(c,.8)|0):-1,s=(Se("#cee7f5","#def4ff",.35+.25*xt),r>=0?a[r]:"#cee7f5"),f=Tt[t],d=l?.6+.4*(f%1*2-1)**2:.3;ye.globalAlpha=l?.7*d:.65;const h=pe(s,1.5*kt[t]),u=h.width>>1,m=h.height>>1;ye.drawImage(h,e-u,n-m)}if(t.drawImage(me,0,0),zt(t,xt,!1,1),ot.setTransform(1,0,0,1,0,0),ot.globalCompositeOperation="source-over",ot.globalAlpha=1,ot.drawImage(lt,0,0,o*at,i*at,0,0,o,i),function(t){if(0===j.length)return;const e=performance.now();t.save(),t.globalCompositeOperation="lighter";for(let n=j.length-1;n>=0;n--){const o=j[n],i=e-(o.t0+o.delay);if(i<0)continue;if(i>K){j.splice(n,1);continue}const c=i/K,a=q+(G-q)*c*c,l=.55*(1-c);t.lineWidth=X,t.strokeStyle=Z+l+")",t.beginPath(),t.arc(o.x,o.y,a,0,2*Math.PI),t.stroke()}t.restore()}(ot),!R.active)return;const l=R.r,r=R.zoom,s=2*l/r,f=2*l/r,d=R.x-s/2,h=R.y-f/2,u=R.x-l,m=R.y-l,y=2*l,g=2*l;ot.save(),ot.beginPath(),ot.arc(R.x,R.y,l,0,2*Math.PI),ot.clip(),ot.imageSmoothingEnabled=!0,ot.imageSmoothingQuality="high",ot.drawImage(lt,d*at,h*at,s*at,f*at,u,m,y,g),ot.drawImage(le,d,h,s,f,u,m,y,g),zt(ot,xt,!0,r);const p=ot.createRadialGradient(R.x,R.y,l-R.feather,R.x,R.y,l);p.addColorStop(0,"rgba(0,0,0,0)"),p.addColorStop(1,"rgba(0,0,0,0.25)"),ot.globalCompositeOperation="source-over",ot.fillStyle=p,ot.fillRect(u,m,y,g),ot.globalCompositeOperation="overlay",ot.lineWidth=2,ot.strokeStyle="rgba(255,255,255,0.25)",ot.beginPath(),ot.arc(R.x,R.y,l-1,0,2*Math.PI),ot.stroke(),ot.restore()}nt.addEventListener("pointerdown",(t=>{const e=Ne(t);if("touch"!==t.pointerType){if("touch"!==t.pointerType&&nt.setPointerCapture(t.pointerId),2===t.button)return R.active=!0,R.x=e.x,void(R.y=e.y);S.active=!0,S.id=t.pointerId,S.x=S.px=e.x,S.y=S.py=e.y,S.vx=S.vy=0,W(e.x,e.y)}else{if(z.set(t.pointerId,e),1===z.size)nt.setPointerCapture?.(t.pointerId),S.active=!0,S.id=t.pointerId,S.x=S.px=e.x,S.y=S.py=e.y,S.vx=S.vy=0,Y.active=!1,R.active=!1,W(e.x,e.y);else if(2===z.size){S.active=!1,S.id=-1,S.vx=0,S.vy=0;const t=U();R.active=!0,R.x=t.x,R.y=t.y,R.zoom=N,R.r=Math.max(60,Math.min(H,.2*Math.min(o,i))),Y.active=!0,Y.startDist=V(),Y.baseZoom=N}t.preventDefault()}}),{passive:!1}),nt.addEventListener("pointermove",(t=>{const e=Ne(t);if("touch"===t.pointerType){if(z.has(t.pointerId)&&z.set(t.pointerId,e),Y.active&&z.size>=2){const t=U();R.x=t.x,R.y=t.y;const e=V(),o=Y.startDist||1;if(e<=o)R.zoom=N;else{const t=e/o,i=n(Y.baseZoom*Math.pow(t,D),N,$);R.zoom=J(R.zoom,i,P)}}else S.active&&t.pointerId===S.id&&(S.vx=e.x-S.x,S.vy=e.y-S.y,S.px=S.x,S.py=S.y,S.x=e.x,S.y=e.y);return void t.preventDefault()}if(R.active&&(R.x=e.x,R.y=e.y),!S.active&&"touch"!==t.pointerType&&1&t.buttons&&(S.active=!0,S.id=t.pointerId,S.x=S.px=e.x,S.y=S.py=e.y,S.vx=S.vy=0,nt.setPointerCapture?.(t.pointerId)),"touch"!==t.pointerType&&0==(1&t.buttons))return void(S.active&&t.pointerId===S.id&&(S.active=!1,S.id=-1,S.vx=S.vy=0));if(!S.active||t.pointerId!==S.id)return;const o=t.getCoalescedEvents?t.getCoalescedEvents():[t];for(const t of o){const e=Ne(t);S.vx=e.x-S.x,S.vy=e.y-S.y,S.px=S.x,S.py=S.y,S.x=e.x,S.y=e.y}}),{passive:!1}),nt.addEventListener("pointerup",(t=>{if("touch"===t.pointerType)return S.active&&t.pointerId===S.id&&(S.active=!1,S.id=-1,S.vx=S.vy=0),z.delete(t.pointerId),z.size<2&&(Y.active=!1),void(0===z.size&&(R.active=!1));2!==t.button?t.pointerId===S.id&&(S.active=!1,S.id=-1,S.vx=S.vy=0):R.active=!1})),nt.addEventListener("wheel",(t=>{if(!R.active)return;const e=1===t.deltaMode?16:2===t.deltaMode?800:1,n=t.deltaY*e;if(t.shiftKey){const t=.06*n,e=.45*Math.min(o,i);R.r=Math.max(60,Math.min(e,R.r+t))}else{const t=Math.exp(.0015*-n);R.zoom=Math.max(1.5,Math.min(4,R.zoom*t))}t.preventDefault()}),{passive:!1});let Pe=null;function He(t=15e3){Pe&&clearInterval(Pe),Pe=setInterval(Le,t)}let ze=performance.now();Le(),He(15e3),ve(Date.now()>>>0^11631617),xe(),function(){E.root=document.getElementById("ui"),E.toggleBtn=document.getElementById("uiToggle"),E.feeFast=document.getElementById("feeFast"),E.feeHalf=document.getElementById("feeHalf"),E.feeHour=document.getElementById("feeHour"),E.blockNum=document.getElementById("blockNum"),E.pending=document.getElementById("pending");const t=document.getElementById("stage");E.toggleBtn.addEventListener("click",(e=>{e.stopPropagation(),t.classList.toggle("ui-open")}));const e=document.getElementById("helpIcon"),n=document.getElementById("helpInfo");let o=!1;e.addEventListener("click",(t=>{t.stopPropagation(),o=!o,o?n.classList.add("show"):n.classList.remove("show")})),document.addEventListener("click",(t=>{o&&!e.contains(t.target)&&(o=!1,n.classList.remove("show"))})),document.addEventListener("touchstart",(t=>{o&&!e.contains(t.target)&&(o=!1,n.classList.remove("show"))})),n.addEventListener("contextmenu",(t=>{t.preventDefault()})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&o&&(o=!1,n.classList.remove("show"))}));let i=!0;const c=document.querySelectorAll("#ui, .font-controls, .help-icon, #uiToggle");function a(){i=!i,c.forEach((t=>{i?(t.style.display="",t.style.pointerEvents=""):(t.style.display="none",t.style.pointerEvents="none")})),!i&&o&&(o=!1,n.classList.remove("show"))}document.addEventListener("keydown",(t=>{"h"===t.key.toLowerCase()&&a()}));let l=0;document.addEventListener("touchstart",(t=>{l=t.touches.length,3===l&&(t.preventDefault(),a())})),Ce()}(),requestAnimationFrame((function e(n){Math.min(.033,(n-ze)/1e3),ze=n,$e(),t++,De(),requestAnimationFrame(e)}))}document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("fontCycle"),e=document.getElementById("fontLock"),n=document.getElementById("activityOverride");t&&t.addEventListener("click",cycleFont),e&&e.addEventListener("click",toggleFontLock),n&&n.addEventListener("click",(()=>{window.toggleActivityOverride?window.toggleActivityOverride():console.log("[activity-override] Function not yet available - startApp() must run first")}))})),(async()=>{await chooseOrdinalFont(),await initializeFontCycling(),startApp()})();
  </script>
</body>
</html>
